function scrollToQueryId(e){var t,a,e=document.getElementById("uagb-block-queryid-"+e);e&&(e=e.getBoundingClientRect(),t=document.querySelector("#wpadminbar")?.offsetHeight||0,a=window?.pageYOffset||document?.documentElement?.scrollTop,e=e?.top+a-t,window.scrollTo({top:e,behavior:"smooth"}))}function findAncestorWithClass(e,t){for(;e&&!e.classList.contains(t);)e=e.parentNode;return e}function getUpdatedLoopWrapperContent(e){return e.append("action","uagb_update_loop_builder_content"),e.append("postId",uagb_loop_builder?.post_id),e.append("postType",uagb_loop_builder?.what_post_type),e.append("security",uagb_loop_builder?.nonce),fetch(uagb_loop_builder?.ajax_url,{method:"POST",credentials:"same-origin",body:e}).then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{if(e.success)return e.data;throw new Error(e.data.message)}).catch(e=>{throw e})}document.addEventListener("DOMContentLoaded",function(){function a(a,o){let r;return function(...e){const t=this;clearTimeout(r),r=setTimeout(()=>{r=null,a.apply(t,e)},o)}}function v(e,t,a){e&&t&&e.setAttribute("data-active-filter-"+a,t)}function k(e,t){return e?.getAttribute("data-active-filter-"+t)||null}async function r(t,a=null,o=null,r){try{var l,u,c,n=r,d=new FormData,i=n?.querySelector(".uagb-loop-search")?.value||"",p=n?.querySelector(".uagb-loop-sort")?.value||"",b=n?.querySelector(".uagb-loop-category"),g=(b?.value?(d.append("category",b.value),v(n,b.value,"select")):(l=k(n,"select"))&&d.append("category",l),n?.querySelectorAll(".uagb-cat-checkbox"));const s=[];g?.forEach(e=>{e.checked&&e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&s.push(e.value)}),!k(n,"button")&&o?.type&&v(n,o.type,"button"),d.delete("buttonFilter"),d.delete("checkbox"),d.delete("category"),n.removeAttribute("data-active-filter-checkbox"),n.removeAttribute("data-active-filter-select"),n.removeAttribute("data-active-filter-button"),t.target.classList.contains("uagb-cat-checkbox")?(b&&(b.value=""),d.append("checkbox",s),v(n,JSON.stringify(s),"checkbox")):t.target.classList.contains("uagb-loop-category")?(g?.forEach(e=>{e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&(e.checked=!1)}),d.append("category",b.value),v(n,b.value,"select")):o?.type&&(b&&(b.value=""),g?.forEach(e=>{e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&(e.checked=!1)}),d.append("buttonFilter",o.type),v(n,o.type,"button")),i&&d.append("search",i),p&&d.append("sorting",p),a&&d.append("paged",a);let e=null;scrollToQueryId(e="all"===o?.type?(u=document.querySelector("[data-query-id]"))?u.getAttribute("data-query-id"):0:t.target?.dataset?.uagbBlockQueryId||t.target?.parentElement?.dataset?.uagbBlockQueryId||t?.dataset?.uagbBlockQueryId||t.target.closest("a")?.getAttribute("data-uagb-block-query-id")||0),d.append("queryId",e),d.append("block_id",n?.getAttribute("data-block_id")),d.append("action","uagb_update_loop_builder_content"),d.append("postId",uagb_loop_builder.post_id),d.append("postType",uagb_loop_builder.post_type),d.append("security",uagb_loop_builder.nonce);const y={},h=(d.forEach((e,t)=>{y[t]=e}),await getUpdatedLoopWrapperContent(d));h?.content?.wrapper&&(c=n?.querySelector("#uagb-block-queryid-"+e))&&(c.innerHTML=h.content.wrapper),h?.content?.pagination&&(n?.querySelectorAll("#uagb-block-pagination-queryid-"+e))?.forEach(e=>{e.innerHTML=h.content.pagination})}catch(e){throw e}}function o(t){var e=this.closest(".wp-block-uagb-loop-builder");e.querySelectorAll(".uagb-loop-search").forEach(e=>{e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&(e.value=t.target.value)}),r(t,null,null,e)}function l(t){var e=this.closest(".wp-block-uagb-loop-builder"),a=e.querySelectorAll(".uagb-cat-checkbox");const o=[];a.forEach(e=>{e.checked&&e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&o.push(e.value)}),r(t,null,null,e)}function u(t){var e=this.closest(".wp-block-uagb-loop-builder");e.querySelectorAll(".uagb-loop-sort").forEach(e=>{e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&(e.value=t.target.value)}),r(t,null,null,e)}function c(t){var e=this.closest(".wp-block-uagb-loop-builder");e.querySelectorAll(".uagb-loop-category").forEach(e=>{e.getAttribute("data-uagb-block-query-id")===t.target.dataset.uagbBlockQueryId&&(e.value=t.target.value)}),t.target.value&&""!==t.target.value&&"all"!==t.target.value||e.removeAttribute("data-active-filter-select"),r(t,null,null,e)}function n(e,t,a,o){e.querySelectorAll(t).forEach(e=>{e.dataset.uagbBlockQueryId===a&&o(e)})}function d(e){var t=this.closest(".wp-block-uagb-loop-builder");let a=e.target.parentElement.dataset.uagbBlockQueryId;"a"===e.target.tagName.toLowerCase()?a=e.target.dataset.uagbBlockQueryId:"svg"!==e.target.tagName.toLowerCase()&&"path"!==e.target.tagName.toLowerCase()||(a=e.target.closest("a")?.getAttribute("data-uagb-block-query-id"));var o=findAncestorWithClass(e.target.parentNode,"wp-block-uagb-loop-builder");n(o,".uagb-loop-search",a,e=>{e.value=""}),n(o,".uagb-loop-sort",a,e=>{e.value=""}),n(o,".uagb-loop-category",a,e=>{e.value=""}),n(o,".uagb-cat-checkbox",a,e=>{e.checked=!1}),o&&(o.removeAttribute("data-active-filter-select"),o.removeAttribute("data-active-filter-checkbox"),o.removeAttribute("data-active-filter-button")),r(e,null,null,t)}var e=document.querySelectorAll(".uagb-loop-reset");document.querySelectorAll(".uagb-loop-search").forEach(e=>{var t=a(o,250);e.addEventListener("input",t)}),document.querySelectorAll(".uagb-loop-sort").forEach(e=>{var t=a(u,250);e.addEventListener("change",t)}),document.querySelectorAll(".uagb-loop-category").forEach(e=>{var t=a(c,250);e.addEventListener("change",t)});const i=document.querySelectorAll(".uagb-cat-checkbox");i.forEach(e=>{var t=a(l,250);e.addEventListener("click",t)}),e.forEach(e=>{var t=a(d,250);e.addEventListener("click",t)}),document.querySelectorAll(".wp-block-uagb-loop-builder > :not(.uagb-loop-pagination).wp-block-uagb-buttons")?.forEach(function(e){var t=document.createElement("div"),a=(t.classList.add("uagb-loop-pagination"),e.querySelector("a").getAttribute("data-uagb-block-query-id"));t.id="uagb-block-pagination-queryid-"+a,t.innerHTML=e.outerHTML,e.parentNode.insertBefore(t,e.nextSibling),e.parentNode.removeChild(e)}),document.querySelectorAll(".uagb-loop-pagination").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const a=this.closest(".wp-block-uagb-loop-builder");var t=e.target.dataset.uagbBlockQueryPaged||e.target.parentElement.dataset.uagbBlockQueryPaged||e?.target?.closest("a")?.getAttribute("data-uagb-block-query-paged"),o=k(a,"button"),r=k(a,"select"),l=k(a,"checkbox");const u=new FormData;t&&u.append("paged",t),o?u.append("buttonFilter",o):r?u.append("category",r):l&&u.append("checkbox",l),u.append("queryId",e.target.dataset.uagbBlockQueryId||e.target.parentElement.dataset.uagbBlockQueryId||e?.target?.closest("a")?.getAttribute("data-uagb-block-query-id")||0),u.append("block_id",a?.getAttribute("data-block_id")),u.append("action","uagb_update_loop_builder_content"),u.append("postId",uagb_loop_builder.post_id),u.append("postType",uagb_loop_builder.post_type),u.append("security",uagb_loop_builder.nonce);t=a?.querySelector(".uagb-loop-search")?.value||"",o=a?.querySelector(".uagb-loop-sort")?.value||"";t&&u.append("search",t),o&&u.append("sorting",o),getUpdatedLoopWrapperContent(u).then(t=>{var e;t?.content?.wrapper&&(e=a?.querySelector("#uagb-block-queryid-"+u.get("queryId")))&&(e.innerHTML=t.content.wrapper),t?.content?.pagination&&(a?.querySelectorAll("#uagb-block-pagination-queryid-"+u.get("queryId")))?.forEach(e=>{e.innerHTML=t.content.pagination})}).catch(e=>{throw e})})}),document.querySelectorAll(".uagb-loop-category-inner a").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.closest(".wp-block-uagb-loop-builder");let a=null;"a"===e.target.tagName.toLowerCase()?a=e.target.children[0].dataset.type:"div"===e.target.tagName.toLowerCase()&&"a"===e.target.parentElement.tagName.toLowerCase()&&(a=e.target.dataset.type),i?.forEach(e=>{e.checked=!1}),"all"===a||void 0===a?(t.removeAttribute("data-active-filter-button"),r(e,null,{type:"all"},t)):a&&(v(t,a,"button"),r(e,null,{type:a},t))})})});